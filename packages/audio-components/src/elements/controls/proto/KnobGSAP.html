<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Minimal GSAP Knob Dial</title>
    <style>
      body {
        margin: 0;
        padding: 50px;
        background: #1a1a1a;
        font-family: monospace;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 30px;
      }

      .knob-container {
        position: relative;
        width: 120px;
        height: 120px;
      }

      .knob {
        width: 100%;
        height: 100%;
        background: linear-gradient(145deg, #2d2d2d, #1a1a1a);
        border-radius: 50%;
        border: 2px solid #333;
        position: relative;
        cursor: grab;
        box-shadow:
          0 10px 20px rgba(0, 0, 0, 0.3),
          inset 0 1px 3px rgba(255, 255, 255, 0.1);
      }

      .knob:active {
        cursor: grabbing;
      }

      .knob-indicator {
        position: absolute;
        top: 8px;
        left: 50%;
        transform: translateX(-50%);
        width: 4px;
        height: 30px;
        background: #00ff88;
        border-radius: 2px;
        box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
      }

      .value-display {
        color: #00ff88;
        font-size: 24px;
        font-weight: bold;
        text-align: center;
        min-width: 100px;
      }

      .info {
        color: #666;
        font-size: 14px;
        text-align: center;
        max-width: 300px;
      }
    </style>
  </head>
  <body>
    <div class="knob-container">
      <div class="knob" id="knob">
        <div class="knob-indicator"></div>
      </div>
    </div>

    <div class="value-display" id="valueDisplay">0</div>

    <div class="info">
      Drag to rotate • Values: 0-100 • Smooth interpolation
    </div>

    <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.13.0/dist/Draggable.min.js"></script>

    <script>
      // Register the Draggable plugin
      gsap.registerPlugin(Draggable);

      class MinimalKnob {
        constructor(element, options = {}) {
          this.element = element;
          this.valueDisplay = document.getElementById('valueDisplay');

          // Configuration
          this.minValue = options.minValue || 0;
          this.maxValue = options.maxValue || 100;
          this.minRotation = options.minRotation || 0;
          this.maxRotation = options.maxRotation || 270; // 3/4 turn
          this.snapIncrement = options.snapIncrement || 1;

          this.currentValue = this.minValue;
          this.currentRotation = this.minRotation;

          this.init();
        }

        init() {
          // Create utility functions
          this.rotationToValue = gsap.utils.mapRange(
            this.minRotation,
            this.maxRotation,
            this.minValue,
            this.maxValue
          );

          this.valueToRotation = gsap.utils.mapRange(
            this.minValue,
            this.maxValue,
            this.minRotation,
            this.maxRotation
          );

          // Set initial rotation (start at minimum)
          gsap.set(this.element, { rotation: this.minRotation });

          // Create draggable
          this.draggable = Draggable.create(this.element, {
            type: 'rotation',
            bounds: {
              minRotation: this.minRotation,
              maxRotation: this.maxRotation,
            },
            onDrag: () => this.onDrag(),
            onThrowUpdate: () => this.onDrag(),
            inertia: true,
          })[0];

          this.updateValue();
        }

        onDrag() {
          // Get current rotation and clamp it
          this.currentRotation = gsap.utils.clamp(
            this.minRotation,
            this.maxRotation,
            this.draggable.rotation
          );

          // Convert rotation to value and snap
          let rawValue = this.rotationToValue(this.currentRotation);
          this.currentValue = gsap.utils.snap(this.snapIncrement, rawValue);

          this.updateValue();
        }

        updateValue() {
          // Update display
          this.valueDisplay.textContent = Math.round(this.currentValue);

          // Optional: Trigger custom event for external use
          this.element.dispatchEvent(
            new CustomEvent('knobChange', {
              detail: {
                value: this.currentValue,
                rotation: this.currentRotation,
              },
            })
          );
        }

        // Public method to set value programmatically
        setValue(value) {
          this.currentValue = gsap.utils.clamp(
            this.minValue,
            this.maxValue,
            value
          );
          this.currentRotation = this.valueToRotation(this.currentValue);

          gsap.to(this.element, {
            rotation: this.currentRotation,
            duration: 0.3,
            ease: 'power2.out',
          });

          this.updateValue();
        }

        getValue() {
          return this.currentValue;
        }
      }

      // Initialize the knob
      const knob = new MinimalKnob(document.getElementById('knob'), {
        minValue: 0,
        maxValue: 100,
        minRotation: -135, // Start at -135 degrees
        maxRotation: 135, // End at 135 degrees (270° total range)
        snapIncrement: 1,
      });

      // Example: Listen for value changes
      document.getElementById('knob').addEventListener('knobChange', (e) => {
        console.log('Knob value:', e.detail.value);

        // Example: Use the value to control something else
        // document.body.style.hue = `hue-rotate(${e.detail.value * 3.6}deg)`;
      });

      // Example: Set value programmatically (uncomment to test)
      // setTimeout(() => knob.setValue(75), 2000);
    </script>
  </body>
</html>
